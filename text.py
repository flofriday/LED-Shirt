import time
import matrix

text_color = (0, 255, 0)


def scroll(text, sleep_time):
    text = text.upper()
    length = len(text) - 1 if len(text) > 0 else 0

    for c in text:
        bitmap = char_map[c] if c in char_map else fallback
        length += len(bitmap[0])

    for i in range(matrix.COLS, -length, -1):
        xpos = i
        matrix.clear_all()

        for c in text:
            bitmap = char_map[c] if c in char_map else fallback
            for y, _ in enumerate(bitmap):
                for x, _ in enumerate(bitmap[0]):
                    if bitmap[y][x] != ".":
                        matrix.set_one((xpos + x, y), text_color)

            xpos += len(bitmap[0]) + 1

        matrix.updatePixel()
        time.sleep(sleep_time)


def display(text):
    text = text.upper()
    length = len(text) - 1 if len(text) > 0 else 0

    for c in text:
        bitmap = char_map[c] if c in char_map else fallback
        length += len(bitmap[0])

    xpos = int(matrix.COLS / 2) - int(length / 2)

    matrix.clear_all()

    for c in text:
        bitmap = char_map[c] if c in char_map else fallback
        for y, _ in enumerate(bitmap):
            for x, _ in enumerate(bitmap[0]):
                if bitmap[y][x] != ".":
                    matrix.set_one((xpos + x, y), text_color)

        xpos += len(bitmap[0]) + 1

    matrix.updatePixel()


char_map = {
    "A": [
        ".##.",
        "#..#",
        "#..#",
        "####",
        "#..#",
        "#..#",
        "#..#",
        "....",
    ],
    "B": [
        "###.",
        "#..#",
        "#..#",
        "###.",
        "#..#",
        "#..#",
        "###.",
        "....",
    ],
    "C": [
        ".##.",
        "#..#",
        "#...",
        "#...",
        "#...",
        "#..#",
        ".##.",
        "....",
    ],
    "D": [
        "###.",
        "#..#",
        "#..#",
        "#..#",
        "#..#",
        "#..#",
        "###.",
        "....",
    ],
    "E": [
        "####",
        "#...",
        "#...",
        "###.",
        "#...",
        "#...",
        "####",
        "....",
    ],
    "F": [
        "####",
        "#...",
        "#...",
        "###.",
        "#...",
        "#...",
        "#...",
        "....",
    ],
    "G": [
        ".###.",
        "#...#",
        "#...",
        "#..##",
        "#...#",
        "#...#",
        ".###.",
        ".....",
    ],
    "H": [
        "#..#",
        "#..#",
        "#..#",
        "####",
        "#..#",
        "#..#",
        "#..#",
        "....",
    ],
    "J": [
        "...#",
        "...#",
        "...#",
        "...#",
        "...#",
        "#..#",
        ".##.",
        "....",
    ],
    "K": [
        "#...#",
        "#..#.",
        "#.#..",
        "##..",
        "#.#..",
        "#..#.",
        "#...#",
        ".....",
    ],
    "L": [
        "#...",
        "#...",
        "#...",
        "#...",
        "#...",
        "#...",
        "####",
        "....",
    ],
    "M": [
        "#...#",
        "##.##",
        "#.#.#",
        "#...#",
        "#...#",
        "#...#",
        "#...#",
        ".....",
    ],
    "N": [
        "##..#",
        "##..#",
        "#.#.#",
        "#.#.#",
        "#..##",
        "#..##",
        "#...#",
        ".....",
    ],
    "O": [
        ".###.",
        "#...#",
        "#...#",
        "#...#",
        "#...#",
        "#...#",
        ".###.",
        ".....",
    ],
    "P": [
        "###.",
        "#..#",
        "#..#",
        "###.",
        "#...",
        "#...",
        "#...",
        "....",
    ],
    "Q": [
        ".###.",
        "#...#",
        "#...#",
        "#...#",
        "#...#",
        "#.#.#",
        ".###.",
        "....#",
    ],
    "R": [
        "###.",
        "#..#",
        "#..#",
        "###.",
        "##..",
        "#.#.",
        "#..#",
        "....",
    ],
    "S": [
        ".##.",
        "#..#",
        "#...",
        ".##.",
        "...#",
        "#..#",
        ".##.",
        "....",
    ],
    "T": [
        "#####",
        "..#..",
        "..#..",
        "..#..",
        "..#..",
        "..#..",
        "..#..",
        ".....",
    ],
    "U": [
        "#..#",
        "#..#",
        "#..#",
        "#..#",
        "#..#",
        "#..#",
        ".##.",
        "....",
    ],
    "V": [
        "#...#",
        "#...#",
        "#...#",
        ".#.#.",
        ".#.#.",
        ".#.#.",
        "..#..",
        ".....",
    ],
    "W": [
        "#...#",
        "#...#",
        "#...#",
        "#...#",
        "#...#",
        "#.#.#",
        ".#.#.",
        ".....",
    ],
    "X": [
        "#...#",
        "#...#",
        ".#.#.",
        "..#..",
        ".#.#.",
        "#...#",
        "#...#",
        ".....",
    ],
    "Y": [
        "#...#",
        "#...#",
        ".#.#.",
        "..#..",
        "..#..",
        "..#..",
        "..#..",
        ".....",
    ],
    "Z": [
        "#####",
        "....#",
        "...#.",
        "..#..",
        ".#...",
        "#....",
        "#####",
        ".....",
    ],
    " ": [
        "..",
        "..",
        "..",
        "..",
        "..",
        "..",
        "..",
        "..",
    ],
    ".": [
        ".",
        ".",
        ".",
        ".",
        ".",
        ".",
        "#",
        ".",
    ],
    ",": [
        ".",
        ".",
        ".",
        ".",
        ".",
        ".",
        "#",
        "#",
    ],
    "!": [
        "#",
        "#",
        "#",
        "#",
        "#",
        ".",
        "#",
        ".",
    ],
}

fallback = [
    ".....",
    ".....",
    "#####",
    "##.##",
    "#.#.#",
    "##.##",
    "#####",
    ".....",
]
